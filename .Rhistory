mtext("B/BMSY",2,line=0.7,outer=T)
mtext("Year",1,line=0.7,outer=T)
?polygon
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options))polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj@OM$D/MSEobj@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
}
vline=41
abline(v=yrs[vline])
runApp()
MPcols<-rep('purple',MSEobj_reb@nMPs)
MPs<-MSEobj_reb@MPs
nMPs<-length(MPs)
if("burnin"%in%names(options)){
yrs<-Current_Year+(1:20)-options$burnin
}else{
yrs<-Current_Year+(1:20)
}
nr<-ceiling(nMPs/maxcol)
nc<-maxcol
par(mfrow=c(nr,nc),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
B_BMSY<-MSEobj_reb@B_BMSY[,,1:20]
B_B0<-MSEobj_reb@B_BMSY*MSEobj_reb@OM$SSBMSY_SSB0#<-MSEobj_reb@C/ array(rep(MSEobj_reb@C[,,1],MSEobj_reb@proyears),dim(MSEobj_reb@C))#MSEobj_reb@OM$RefY
Blims <- c(0,quantile(B_BMSY,0.95))
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options))polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj_reb@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
abline(v=yrs[1]+range(MGT2),col='red')
legend('bottom',legend="Two mean generation times",text.col='red',bty='n')
}
}
mtext("B/BMSY",2,line=0.7,outer=T)
mtext("Projection Year",1,line=0.7,outer=T)
B_BMSY<-MSEobj_reb@B_BMSY[,,1:20,drop=F]
B_B0<-MSEobj_reb@B_BMSY*MSEobj_reb@OM$SSBMSY_SSB0#<-MSEobj_reb@C/ array(rep(MSEobj_reb@C[,,1],MSEobj_reb@proyears),dim(MSEobj_reb@C))#MSEobj_reb@OM$RefY
Blims <- c(0,quantile(B_BMSY,0.95))
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options))polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj_reb@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
abline(v=yrs[1]+range(MGT2),col='red')
legend('bottom',legend="Two mean generation times",text.col='red',bty='n')
}
}
MGT2
MGT2<-2* MSEobj_reb@OM$MGT
abline(v=yrs[1]+range(MGT2),col='red')
legend('bottom',legend="Two mean generation times",text.col='red',bty='n')
legend('bottomright',legend="Two mean generation times",text.col='red',bty='n')
runApp()
MPcols<-rep('purple',MSEobj_reb@nMPs)
MPs<-MSEobj_reb@MPs
nMPs<-length(MPs)
if("burnin"%in%names(options)){
yrs<-Current_Year+(1:20)-options$burnin
}else{
yrs<-Current_Year+(1:20)
}
nr<-ceiling(nMPs/maxcol)
nc<-maxcol
par(mfrow=c(nr,nc),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
B_BMSY<-MSEobj_reb@B_BMSY[,,1:20,drop=F]
B_B0<-MSEobj_reb@B_BMSY*MSEobj_reb@OM$SSBMSY_SSB0#<-MSEobj_reb@C/ array(rep(MSEobj_reb@C[,,1],MSEobj_reb@proyears),dim(MSEobj_reb@C))#MSEobj_reb@OM$RefY
Blims <- c(0,quantile(B_BMSY,0.95))
plotMGT=T
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options))polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
polygon(yrs[1]+c(min(MGT2),max(MGT2),max(MGT2),min(MGT2)),c(-10,-10,10,10),col='light orange',border=NA)
#legend('bottomright',legend="Two mean generation times",text.col='grey',bty='n')
}
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj_reb@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
}
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options))polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
polygon(yrs[1]+c(min(MGT2),max(MGT2),max(MGT2),min(MGT2)),c(-10,-10,10,10),col='lightorange',border=NA)
#legend('bottomright',legend="Two mean generation times",text.col='grey',bty='n')
}
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj_reb@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
}
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options))polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
polygon(yrs[1]+c(min(MGT2),max(MGT2),max(MGT2),min(MGT2)),c(-10,-10,10,10),col='orange',border=NA)
#legend('bottomright',legend="Two mean generation times",text.col='grey',bty='n')
}
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj_reb@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
}
mtext("B/BMSY",
nMPs<-MSEobj_reb@nMPs
proyears<-MSEobj_reb@proyears
MGT2<-2* MSEobj_reb@OM$MGT
ind<-1:20
TRP<-matrix(round(apply(MSEobj_reb@B_BMSY[,,ind,drop=FALSE]>1,2:3,mean)*100,rnd)[,ind],nrow=nMPs)
shaderng=range(ceiling(MGT2))
#shaderng[2]<-min(20,shaderng[2])
Tab4<-as.data.frame(cbind(MSEobj_reb@MPs,TRP))
colnams<-c("MP",Current_Year+(1:20)-options$burnin)
names(Tab4)<-colnams
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0 #MSEobj_reb@B_BMSY[,1,1]#
caption=paste0("Simulations start between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" )
datatable(Tab4,caption=caption)%>%
formatStyle(columns = 2:ncol(Tab4), valueColumns = 2:ncol(Tab4), color = styleInterval(c(25,50,100),c('red','orange','green','darkgreen')))%>%
formatStyle(colnams[1+shaderng[1]:shaderng[2]],backgroundColor='#ff000050')
shaderng
nMPs<-MSEobj_reb@nMPs
proyears<-MSEobj_reb@proyears
MGT2<-2* MSEobj_reb@OM$MGT
ind<-1:20
TRP<-matrix(round(apply(MSEobj_reb@B_BMSY[,,ind,drop=FALSE]>1,2:3,mean)*100,rnd)[,ind],nrow=nMPs)
shaderng=range(ceiling(MGT2))
#shaderng[2]<-min(20,shaderng[2])
Tab4<-as.data.frame(cbind(MSEobj_reb@MPs,TRP))
colnams<-c("MP",Current_Year+(1:20)-options$burnin)
names(Tab4)<-colnams
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0 #MSEobj_reb@B_BMSY[,1,1]#
caption=paste0("Simulations start between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" )
datatable(Tab4,caption=caption)%>%
formatStyle(columns = 2:ncol(Tab4), valueColumns = 2:ncol(Tab4), color = styleInterval(c(25,50,100),c('red','orange','green','darkgreen')))%>%
formatStyle(colnams[1+shaderng[1]:shaderng[2]],backgroundColor='dark grey')
shaderng
nMPs<-MSEobj_reb@nMPs
proyears<-MSEobj_reb@proyears
MGT2<-2* MSEobj_reb@OM$MGT
ind<-1:20
TRP<-matrix(round(apply(MSEobj_reb@B_BMSY[,,ind,drop=FALSE]>1,2:3,mean)*100,rnd)[,ind],nrow=nMPs)
shaderng=range(ceiling(MGT2))
#shaderng[2]<-min(20,shaderng[2])
Tab4<-as.data.frame(cbind(MSEobj_reb@MPs,TRP))
colnams<-c("MP",Current_Year+(1:20)-options$burnin)
names(Tab4)<-colnams
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0 #MSEobj_reb@B_BMSY[,1,1]#
caption=paste0("Simulations start between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" )
datatable(Tab4,caption=caption)%>%
formatStyle(columns = 2:ncol(Tab4), valueColumns = 2:ncol(Tab4), color = styleInterval(c(25,50,100),c('red','orange','green','darkgreen')))%>%
formatStyle(colnams[1+shaderng[1]:shaderng[2]],backgroundColor='darkgrey')
nMPs<-MSEobj_reb@nMPs
proyears<-MSEobj_reb@proyears
MGT2<-2* MSEobj_reb@OM$MGT
ind<-1:20
TRP<-matrix(round(apply(MSEobj_reb@B_BMSY[,,ind,drop=FALSE]>1,2:3,mean)*100,rnd)[,ind],nrow=nMPs)
shaderng=range(ceiling(MGT2))
#shaderng[2]<-min(20,shaderng[2])
Tab4<-as.data.frame(cbind(MSEobj_reb@MPs,TRP))
colnams<-c("MP",Current_Year+(1:20)-options$burnin)
names(Tab4)<-colnams
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0 #MSEobj_reb@B_BMSY[,1,1]#
caption=paste0("Simulations start between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" )
datatable(Tab4,caption=caption)%>%
formatStyle(columns = 2:ncol(Tab4), valueColumns = 2:ncol(Tab4), color = styleInterval(c(25,50,100),c('red','orange','green','darkgreen')))%>%
formatStyle(colnams[1+shaderng[1]:shaderng[2]],backgroundColor='lightblue')
MPcols<-rep('purple',MSEobj_reb@nMPs)
MPs<-MSEobj_reb@MPs
nMPs<-length(MPs)
if("burnin"%in%names(options)){
yrs<-Current_Year+(1:20)-options$burnin
}else{
yrs<-Current_Year+(1:20)
}
nr<-ceiling(nMPs/maxcol)
nc<-maxcol
par(mfrow=c(nr,nc),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
B_BMSY<-MSEobj_reb@B_BMSY[,,1:20,drop=F]
B_B0<-MSEobj_reb@B_BMSY*MSEobj_reb@OM$SSBMSY_SSB0#<-MSEobj_reb@C/ array(rep(MSEobj_reb@C[,,1],MSEobj_reb@proyears),dim(MSEobj_reb@C))#MSEobj_reb@OM$RefY
Blims <- c(0,quantile(B_BMSY,0.95))
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options)) abline(v=yrs[options$burnin]) #polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
polygon(yrs[1]+c(min(MGT2),max(MGT2),max(MGT2),min(MGT2)),c(-10,-10,10,10),col='lightgrey',border=NA)
#legend('bottomright',legend="Two mean generation times",text.col='grey',bty='n')
}
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj_reb@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
}
mtext("B/BMSY",2,line=0.7,outer=T)
mtext("Projection Year",1,line=0.7,outer=T)
options
plot(range(yrs),Blims,col="white")
if("burnin"%in%names(options)) abline(v=yrs[options$burnin]) #polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
polygon(yrs[1]+c(min(MGT2),max(MGT2),max(MGT2),min(MGT2)),c(-10,-10,10,10),col='lightgrey',border=NA)
#legend('bottomright',legend="Two mean generation times",text.col='grey',bty='n')
}
MPcols<-rep('purple',MSEobj_reb@nMPs)
MPs<-MSEobj_reb@MPs
nMPs<-length(MPs)
if("burnin"%in%names(options)){
yrs<-Current_Year+(1:20)-options$burnin
}else{
yrs<-Current_Year+(1:20)
}
nr<-ceiling(nMPs/maxcol)
nc<-maxcol
par(mfrow=c(nr,nc),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
B_BMSY<-MSEobj_reb@B_BMSY[,,1:20,drop=F]
B_B0<-MSEobj_reb@B_BMSY*MSEobj_reb@OM$SSBMSY_SSB0#<-MSEobj_reb@C/ array(rep(MSEobj_reb@C[,,1],MSEobj_reb@proyears),dim(MSEobj_reb@C))#MSEobj_reb@OM$RefY
Blims <- c(0,quantile(B_BMSY,0.95))
for(i in 1:nMPs){
plot(range(yrs),Blims,col="white")
if(plotMGT){
MGT2<-2* MSEobj_reb@OM$MGT
polygon(yrs[1]+c(min(MGT2),max(MGT2),max(MGT2),min(MGT2)),c(-10,-10,10,10),col='lightgrey',border=NA)
#legend('bottomright',legend="Two mean generation times",text.col='grey',bty='n')
}
plotquant(B_BMSY[,i,],p=quants,yrs,qcol,lcol,ablines=c(0.5,1))
mtext(MSEobj_reb@MPs[i],3,line=0.2,font=2,col=MPcols[i])
if(i==1){
Bdeps<-MSEobj_reb@OM$D/MSEobj_reb@OM$SSBMSY_SSB0#MSEobj_reb@B_BMSY[,1,1]#
legend('topleft',legend=paste0("Starting between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" ),bty='n')
}
if("burnin"%in%names(options)) abline(v=yrs[options$burnin]) #polygon(yrs[c(1,options$burnin,options$burnin,1)],c(-10,-10,10,10),col='lightgrey',border=NA)
}
mtext("B/BMSY",2,line=0.7,outer=T)
mtext("Projection Year",1,line=0.7,outer=T)
runApp()
VOI_plot(MSEobj,MSEobj_reb,options)
source('C:/GitHub/MERA/inst/shiny_apps/MERA/Source/Skins/Default_skin_funcs.R', echo=TRUE)
VOI_plot(MSEobj,MSEobj_reb,options)
CCU_plot(MSEobj,MSEobj_reb,options)
options
maxrow=1,maxcol=3
MPcols<-rep('purple',MSEobj@nMPs)
#          F2   F3           F4     F5      F6      F7        F8       F9      F10         F11        F12    F13    F14       F15      F16      F17     F18      F19
opt1<-  c("M",  "D", "hs",  "Ftype","Esd",  "qhssim", "qinc",  "L50",  "Sel50sim", "Vmaxlen", "DR",  "Fdisc", "procsd", "Ahsim", "Vhsim", "Asim", "Vsim", "initD",
"TACFrac", "TACSD", "TAEFrac","TAESD", "SizeLimFrac","SizeLimSD","Cbias","betas","RefY")
MSEtemp<-MSEobj
MSEtemp@OM<-cbind(MSEtemp@OM,betas=MSEtemp@Obs$betas,MSEtemp@Misc[[4]])
MSEtemp@OM<-MSEtemp@OM[,names(MSEtemp@OM)%in%opt1]
VOIout<-VOI(MSEtemp,ncomp=15,nbins=8,plot=F)[[1]]
MSEtemp@Misc[[4]]
runApp()
MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
MPplot<-rep(F,MSEobj@nMPs)
MPplot
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
MPplot
sum(MPplot)
sum(!MPplot)
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nMPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
if(sum(!MPplot)>0){
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements:",cex=1.3,bty='n')
}
mtext("Question / operating model characteristic",1,outer=T,line=0.5)
mtext("Variability in Long Term Yield (% LTY)",2,outer=T,line=0.5)
maxcol
maxcol
max(maxrow,nrow)
maxrow=1
maxcol=1
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
maxcol
max(maxrow,nrow)
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
runApp()
MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
nrow
maxrow
maxcol
maxcol=6
MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(nrow,maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
nrow
maxcol
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(nrow,maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
MPplot
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(nrow,maxcol),mai=c(1.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+as.integer(sum(!MPplot)>0) # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(nrow,maxcol),mai=c(1.2,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
if(sum(!MPplot)>0){
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements:",cex=1.3,bty='n')
}
mtext("Question / operating model characteristic",1,outer=T,line=0.5)
mtext("Variability in Long Term Yield (% LTY)",2,outer=T,line=0.5)
runApp()
avail('MPs')
avail('MP')
runApp()
?makeOM
runApp()
shiny::runApp('inst/shiny_apps/MERA')
