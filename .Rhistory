if(pCC)CC(indPPD,indData,pp=1,res=res)
if(!pCC)plot_mdist(indPPD,indData,alpha=0.05)
}
plotInd(MSEobj_Eval,dat,dat_ind,pCC=TRUE)
plotInd(MSEobj_Eval,dat,dat_ind,pCC=FALSE)
pCC=FALSE
plot_mdist(indPPD,indData,alpha=0.05)
plot_mdist(indPPD,indData,alpha=0.05)
BMSYproj(MSEobj_Eval,MSEobj_Eval,options,maxcol=1)
BMSYproj(MSEobj_Eval,MSEobj_Eval,options=list( YIU=length(dat_ind@Year)-length(dat@Year)),maxcol=1)
B0proj(MSEobj_Eval,MSEobj_Eval,options=list( YIU=length(dat_ind@Year)-length(dat@Year)),maxcol=1)
runApp('inst/shiny_apps/MERA')
MSEobj_Eval<-readRDS(file="C:/temp/MSEobj_Eval.Rdata")
dat<-readRDS(file="C:/temp/dat.Rdata")
dat_ind<-readRDS(file="C:/temp/dat_ind.Rdata")
source("C:/Users/tcarruth/Documents/GitHub/MERA/inst/shiny_apps/MERA/Source/AI/AI_results.r")
YIU<-length(dat_ind@Year)-length(dat@Year)
nMPs<-MSEobj_Eval@nMPs
proyears<-MSEobj_Eval@proyears
ind<-1:min(5,proyears)
LRP<-matrix(round(apply(MSEobj_Eval@B_BMSY[,,1:YIU,drop=FALSE]>0.5,2:3,mean)*100,rnd)[,ind],nrow=nMPs)
Tab1<-as.data.frame(cbind(MSEobj_Eval@MPs,LRP))
colnams<-c("MP",Current_Year-((YIU-1):0))
names(Tab1)<-colnams
Tab1$MP<-as.character(Tab1$MP)
URLs <- MPurl(as.character(Tab1$MP))
MPwithurl <- !is.na(URLs)
Tab1$MP[MPwithurl] <- paste0("<a href='", URLs[MPwithurl]," ' target='_blank'>", Tab1$MP[MPwithurl],"</a>")
Bdeps<-MSEobj_Eval@OM$D/MSEobj_Eval@OM$SSBMSY_SSB0 #MSEobj_reb@B_BMSY[,1,1]#
caption=paste0("Simulations start between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" )
datatable(Tab1,caption=caption,extensions = 'Buttons',class = 'display',rownames=FALSE,escape=FALSE,
options=list(buttons =
list('copy', list(
extend = 'collection',
buttons = c('csv', 'excel', 'pdf'),
text = 'Download'
)),
dom = 'Brti',
ordering=F
)
)%>%
formatStyle(columns = 2:ncol(Tab1), valueColumns = 2:ncol(Tab1), color = styleInterval(c(50,100),c('red','orange','green')))
YIU<-length(dat_ind@Year)-length(dat@Year)
nMPs<-MSEobj_Eval@nMPs
proyears<-MSEobj_Eval@proyears
ind<-1:min(YIU,proyears)
TRP<-matrix(round(apply(MSEobj_Eval@B_BMSY[,,ind,drop=FALSE]>1,2:3,mean)*100,rnd)[,ind],nrow=nMPs)
Tab2<-as.data.frame(cbind(MSEobj_Eval@MPs,TRP))
colnams<-c("MP",Current_Year-((YIU-1):0))
names(Tab2)<-colnams
Tab2$MP<-as.character(Tab2$MP)
URLs <- sapply(Tab2$MP, MPurl) %>% unlist()
MPwithurl <- !is.na(URLs)
Tab2$MP[MPwithurl] <- paste0("<a href='", URLs[MPwithurl]," ' target='_blank'>", Tab2$MP[MPwithurl],"</a>")
Bdeps<-MSEobj_Eval@OM$D/MSEobj_Eval@OM$SSBMSY_SSB0 #MSEobj_reb@B_BMSY[,1,1]#
caption=paste0("Simulations start between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% BMSY" )
datatable(Tab2,caption=caption, extensions = 'Buttons',class = 'display',rownames=FALSE,escape=FALSE,
options=list(buttons =
list('copy', list(
extend = 'collection',
buttons = c('csv', 'excel', 'pdf'),
text = 'Download'
)),
dom = 'Brti',
ordering=F
)
)%>%
formatStyle(columns = 2:ncol(Tab2), valueColumns = 2:ncol(Tab2), color = styleInterval(c(25,50,100),c('red','orange','green','darkgreen')))
YIU<-length(dat_ind@Year)-length(dat@Year)
B_B0<-MSEobj_Eval@SSB/MSEobj_Eval@OM$SSB0
nMPs<-MSEobj_Eval@nMPs
proyears<-MSEobj_Eval@proyears
ind<-1:min(YIU,proyears)
RP<-matrix(round(apply(B_B0[,,ind,drop=F]>0.2,2:3,mean)*100,rnd),nrow=nMPs)
Tab3<-as.data.frame(cbind(MSEobj_Eval@MPs,RP))
colnams<-c("MP",Current_Year-((YIU-1):0))
names(Tab3)<-colnams
Tab3$MP<-as.character(Tab3$MP)
URLs <- sapply(Tab3$MP, MPurl) %>% unlist()
MPwithurl <- !is.na(URLs)
Tab3$MP[MPwithurl] <- paste0("<a href='", URLs[MPwithurl]," ' target='_blank'>", Tab3$MP[MPwithurl],"</a>")
Bdeps<-MSEobj_Eval@OM$D#MSEobj_reb@B_BMSY[,1,1]#
caption=paste0("Simulations start between ",round(min(Bdeps)*100,0), "% and ", round(max(Bdeps)*100,0), "% of unfished SSB" )
datatable(Tab3,caption=caption,extensions = 'Buttons',class = 'display',rownames=FALSE,escape=FALSE,
options=list(buttons =
list('copy', list(
extend = 'collection',
buttons = c('csv', 'excel', 'pdf'),
text = 'Download'
)),
dom = 'Brti',
ordering=F
)
)%>%
formatStyle(columns = 2:ncol(Tab3), valueColumns = 2:ncol(Tab3), color = styleInterval(c(25,50,100),c('red','orange','green','darkgreen')))
BMSYproj(MSEobj_Eval,MSEobj_Eval,options=list( YIU=length(dat_ind@Year)-length(dat@Year)),maxcol=1)
runApp('inst/shiny_apps/MERA')
MSEobj_Eval<-readRDS(file="C:/temp/MSEobj_Eval.Rdata")
dat<-readRDS(file="C:/temp/dat.Rdata")
dat_ind<-readRDS(file="C:/temp/dat_ind.Rdata")
source("C:/Users/tcarruth/Documents/GitHub/MERA/inst/shiny_apps/MERA/Source/AI/AI_results.r")
styr=max(dat@Year)-min(dat@Year)+1
PPD<-MSEobj_Eval@Misc$Data[[1]]
pred=PPD@Cat
obs=dat_ind@Cat
p=c(0.025,0.05,0.25,0.75,0.95,0.025)
apply(pred,2,quantile,p)
PPD@Cat
styr
max(dat@Year)
min(dat@Year)
length(dat_ind@Year)-length(dat@Year))
YIU
YIU=length(dat_ind@Year)-length(dat@Year))
styr=max(dat@Year)-min(dat@Year)
PPD<-MSEobj_Eval@Misc$Data[[1]]
# Standardization
PPD@Cat<-(PPD@Cat/PPD@Cat[,styr])[,styr+1:YIU]
PPD@Cat
PPD@Ind<-PPD@Ind/PPD@Ind[,styr][,styr+1:YIU]
PPD@Ind
PPD@Ind/PPD@Ind[,styr]
styr+1:YIU
PPD@Cat<-(PPD@Cat/PPD@Cat[,styr])[,styr+(1:YIU)]
PPD@Ind<-(PPD@Ind/PPD@Ind[,styr])[,styr+(1:YIU)]
PPD@ML<-(PPD@ML/PPD@ML[,styr])[,styr+(1:YIU)]
YIU=length(dat_ind@Year)-length(dat@Year))
styr=max(dat@Year)-min(dat@Year)
PPD<-MSEobj_Eval@Misc$Data[[1]]
# Standardization
PPD@Cat<-(PPD@Cat/PPD@Cat[,styr])[,styr+(1:YIU)]
PPD@Ind<-(PPD@Ind/PPD@Ind[,styr])[,styr+(1:YIU)]
PPD@ML<-(PPD@ML/PPD@ML[,styr])[,styr+(1:YIU)]
PPD@Cat
PPD@Ind
PPD@ML
PPD@Cat<-(PPD@Cat/PPD@Cat[,styr])[,styr+(1:YIU)]
PPD@Ind<-(PPD@Ind/PPD@Ind[,styr])[,styr+(1:YIU)]
PPD@ML<-(PPD@ML/PPD@ML[,styr])[,styr+(1:YIU)]
# Standardization
dat_ind@Cat<-(dat_ind@Cat/dat_ind@Cat[,styr])[,styr+(1:YIU)]
dat_ind@Ind<-(dat_ind@Ind/dat_ind@Ind[,styr])[,styr+(1:YIU)]
dat_ind@ML<-(dat_ind@ML/dat_ind@ML[,styr])[,styr+(1:YIU)]
dat_ind@Cat
dat_ind@Cat<-(dat_ind@Cat/dat_ind@Cat[,styr])[styr+(1:YIU)]
dat_ind@Ind<-(dat_ind@Ind/dat_ind@Ind[,styr])[styr+(1:YIU)]
dat_ind@ML<-(dat_ind@ML/dat_ind@ML[,styr])[styr+(1:YIU)]
(dat_ind@Cat/dat_ind@Cat[,styr])
YIU=length(dat_ind@Year)-length(dat@Year))
styr=max(dat@Year)-min(dat@Year)
PPD<-MSEobj_Eval@Misc$Data[[1]]
# Standardization
predCat<-(PPD@Cat/PPD@Cat[,styr])[,styr+(1:YIU)]
predInd<-(PPD@Ind/PPD@Ind[,styr])[,styr+(1:YIU)]
predML<-(PPD@ML/PPD@ML[,styr])[,styr+(1:YIU)]
# Standardization
obsCat<-(dat_ind@Cat/dat_ind@Cat[,styr])[styr+(1:YIU)]
obsInd<-(dat_ind@Ind/dat_ind@Ind[,styr])[styr+(1:YIU)]
obsML<-(dat_ind@ML/dat_ind@ML[,styr])[styr+(1:YIU)]
obsCat
obsInd
obsML
predCat
predInd
predML
pred=predCat
obs=obsCat
apply(pred,2,quantile,p)
range(pred,obs)
at@Year[styr+(1:YIU)]
dat_ind@Year
dat_ind@Year[styr+(1:YIU)]
styr
yrlab<-dat_ind@Year[styr+(1:YIU)]
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
polygon(yrlab[yind],c(qmat[1,],qmat[6,]))
yrlab[yind]
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col="light grey")
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col="light grey")
?polygon
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col="light grey")
qmat
c(qmat[1,],qmat[6,rind])
p=c(0.025,0.05,0.25,0.75,0.95,0.975)
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col="light grey")
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col="light grey",border="light grey")
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=rgb(0.4,0.8,0.95),border=rgb(0.4,0.8,0.95))
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col="dodgerblue4",border="dodgerblue4")
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col="light grey",border="light grey")
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=rgb(0.4,0.8,0.95),border=rgb(0.4,0.8,0.95))
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col="dodgerblue4",border="dodgerblue4")
pcols=c("grey85","grey66","grey43")
lab=""
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
pcols=c("grey85","grey70","grey53")
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
mtext(lab,3,line=0.6,font=2)
pcols=c("grey87","grey72","grey55")
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
mtext(lab,3,line=0.6,font=2)
pcols=c("grey90","grey75","grey60")
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
mtext(lab,3,line=0.6,font=2)
pcols=c("grey90","grey78","grey63")
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
mtext(lab,3,line=0.6,font=2)
pcols=c("grey90","grey78","grey66")
qmat<-apply(pred,2,quantile,p)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:length(obs),length(obs):1)
rind<-length(obs):1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
mtext(lab,3,line=0.6,font=2)
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,pcex=1.2)
points(yrlab,obs,pch=1,pcex=1.2)
pcex=1.2
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,pcex=1.2)
points(yrlab,obs,pch=1,pcex=1.2)
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
points(yrlab,obs,pch=1,cex=pcex)
obs<-seq(ylim[1],ylim[2],length.out=nobs)
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
# obs<-seq(ylim[1],ylim[2],length.out=nobs)
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
obs<-seq(ylim[1],ylim[2],length.out=nobs)
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
points(yrlab,obs,pch=2,cex=pcex)
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
obs<-seq(ylim[1],ylim[2],length.out=nobs)
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
points(yrlab,obs,pch=1,cex=pcex)
obs<-qmat[cbind(1:nobs,1:nobs)]+0.01
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
obs<-qmat[cbind(1:nobs,1:nobs)]+0.01
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
points(yrlab,obs,pch=1,cex=pcex)
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
obs<-qmat[cbind(1:nobs,1:nobs)]-0.05
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
points(yrlab,obs,pch=1,cex=pcex)
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
obs<-qmat[cbind(1:nobs,1:nobs)]-0.02
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
points(yrlab,obs,pch=1,cex=pcex)
par(mfrow=c(1,3),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
ppdplot(pred=predCat,obs=obsCat,lab="Catches")
ppdplot(pred=predML,obs=obsML,lab="Mean Length in Catch")
ppdplot(pred=predInd,obs=obsInd,lab="Index of Abundance")
ppdplot<-function(pred,obs,yrlab,p=c(0.025,0.05,0.25,0.75,0.95,0.975),pcols=c("grey90","grey78","grey66"),lab="",pcex=1.2){
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
#obs<-qmat[cbind(1:nobs,1:nobs)]-0.02
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
points(yrlab,obs,pch=1,cex=pcex)
mtext(lab,3,line=0.6,font=2)
}
par(mfrow=c(1,3),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
ppdplot(pred=predCat,obs=obsCat,lab="Catches")
ppdplot(pred=predML,obs=obsML,lab="Mean Length in Catch")
ppdplot(pred=predInd,obs=obsInd,lab="Index of Abundance")
par(mfrow=c(1,3),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
ppdplot(pred=predCat,obs=obsCat,yrlab,lab="Catches")
ppdplot(pred=predML,obs=obsML,yrlab,lab="Mean Length in Catch")
ppdplot(pred=predInd,obs=obsInd,yrlab,lab="Index of Abundance")
legend('topleft',legend=c("95% PI","90% PI","50% PI"),fill=c("grey90","grey78","grey66"))
legend('topleft',legend=c("95% PI","90% PI","50% PI"),fill=c("grey90","grey78","grey66"),title="Pred. Data")
legend('topright',legend=c("Consistent","Borderline","Inconsistent"),pch=19,col=c("black","orange","red"),title="Obs. Data",text.col=c("black","orange","red"))
ppdplot<-function(pred,obs,yrlab,p=c(0.025,0.05,0.25,0.75,0.95,0.975),pcols=c("grey90","grey78","grey66"),lab="",pcex=1.2){
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
#obs<-qmat[cbind(1:nobs,1:nobs)]-0.02
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
#points(yrlab,obs,pch=1,cex=pcex)
mtext(lab,3,line=0.6,font=2)
}
par(mfrow=c(1,3),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
ppdplot(pred=predCat,obs=obsCat,yrlab,lab="Catches")
ppdplot(pred=predML,obs=obsML,yrlab,lab="Mean Length in Catch")
ppdplot(pred=predInd,obs=obsInd,yrlab,lab="Index of Abundance")
legend('topleft',legend=c("95% PI","90% PI","50% PI"),fill=c("grey90","grey78","grey66"),title="Pred. Data")
legend('topright',legend=c("Consistent","Borderline","Inconsistent"),pch=19,col=c("black","orange","red"),title="Ob
YIU=length(dat_ind@Year)-length(dat@Year))
styr=max(dat@Year)-min(dat@Year)
PPD<-MSEobj_Eval@Misc$Data[[1]]
# Standardization
predCat<-(PPD@Cat/PPD@Cat[,styr])[,styr+(1:YIU),drop=F]
predInd<-(PPD@Ind/PPD@Ind[,styr])[,styr+(1:YIU),drop=F]
predML<-(PPD@ML/PPD@ML[,styr])[,styr+(1:YIU),drop=F]
# Standardization
obsCat<-(dat_ind@Cat/dat_ind@Cat[,styr])[styr+(1:YIU)]
obsInd<-(dat_ind@Ind/dat_ind@Ind[,styr])[styr+(1:YIU)]
obsML<-(dat_ind@ML/dat_ind@ML[,styr])[styr+(1:YIU)]
yrlab<-dat_ind@Year[styr+(1:YIU)]
ppdplot<-function(pred,obs,yrlab,p=c(0.025,0.05,0.25,0.75,0.95,0.975),pcols=c("grey90","grey78","grey66"),lab="",pcex=1.2){
qmat<-apply(pred,2,quantile,p)
nobs<-length(obs)
ylim<-range(pred,obs)
plot(range(yrlab),ylim,col="white")
yind<-c(1:nobs,nobs:1)
rind<-nobs:1
polygon(yrlab[yind],c(qmat[1,],qmat[6,rind]),col=pcols[1],border=pcols[1])
polygon(yrlab[yind],c(qmat[2,],qmat[5,rind]),col=pcols[2],border=pcols[2])
polygon(yrlab[yind],c(qmat[3,],qmat[4,rind]),col=pcols[3],border=pcols[3])
#obs<-qmat[cbind(1:nobs,1:nobs)]-0.02
ocol<-rep("black",nobs)
ocol[obs<qmat[2,]|obs>qmat[5,]]<-"orange"
ocol[obs<qmat[1,]|obs>qmat[6,]]<-"red"
points(yrlab,obs,col=ocol,pch=19,cex=pcex)
#points(yrlab,obs,pch=1,cex=pcex)
mtext(lab,3,line=0.6,font=2)
}
par(mfrow=c(1,3),mai=c(0.3,0.3,0.2,0.01),omi=c(0.5,0.5,0.05,0.05))
ppdplot(pred=predCat,obs=obsCat,yrlab,lab="Catch")
ppdplot(pred=predML,obs=obsML,yrlab,lab="Mean Length in Catch")
ppdplot(pred=predInd,obs=obsInd,yrlab,lab="Index of Abundance")
mtext("Year",1,line=1.5,outer=T)
mtext(paste("Data relative to",yrlab[1]-1),2,line=1.5,outer=T)
legend('topleft',legend=c("95% PI","90% PI","50% PI"),fill=c("grey90","grey78","grey66"),title="Pred. Data")
legend('topright',legend=c("Consistent","Borderline","Inconsistent"),pch=19,col=c("black","orange","red"),title="Obs. Data",text.col=c("black","orange","red"))
source('~/GitHub/MERA/inst/shiny_apps/MERA/Source/Skins/MSC.R', echo=TRUE)
runApp('inst/shiny_apps/MERA')
