MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
nMPs<-MSEobj@nMPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
maxrow=1
MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
nMPs<-MSEobj@nMPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:16]
VOIout[,1]
VOIout[match(MP,VOIout[,1])+0:1,2:16]
match(MP,VOIout[,1])
MP
i<-1
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:16]
match(MP,VOIout[,1])
match(MP,VOIout[,1])+0:1
VOIout[match(MP,VOIout[,1])+0:1,2:16]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
dat
unlist(dat[1,])
i<-1
i<-2
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
dat
match(as.factor(unlist(dat[1,])),opt1)
unlist(dat[1,])
match(unlist(dat[1,]),opt1)
unlist(dat[1,])
dat
dat[2,]!=""
dat<-dat[,dat[2,]!=""]
View(dat)
dat
unlist(dat[1,])
dat[1,]
match(dat[1,],opt1)
as.character(dat[1,]),opt1
as.character(dat[1,])
dat[1,]
as.character(as.factor(dat[1,]))
dat[1,]
dat<-dat[,dat[2,]]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
dat<-dat[,dat[2,]]
dat
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
dat<-dat[,dat[2,]!=""]
dat
Obsgot<-dat[,2]
Obsgot
Obsgot<-dat[1,]
Obsgot
match(Obsgot,opt1)
opt1
Obsgot<-as.character(dat[1,])
Obsgot
unlist(dat[1,])
as.character(unlist(dat[1,]))
match(Obsgot,opt1)
opt1
Obsgot<-as.character(unlist(dat[1,]))
match(Obsgot,opt1)
Obsgot
match(Obsgot,Obsnam)
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2
dat2<-dat2[order(dat2$x,decreasing=T),]
dat2
labs<-dat2[,1]
labs
barplot(dat2[,2],names.arg=labs[match(dat2[,1],qno)], las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
dat2
mtext(MP,3,adj=0.8,font=2,cex=1,col=MPcols[i])
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
ind
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
if(sum(ind)>0){
dat<-dat[,ind]
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,adj=0.8,font=2,cex=1,col=MPcols[i])
}else{
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
legend('center',legend="MP is prescriptive - no data used",bty='n')
}
}
i
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
ind
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
if(sum(ind[2:length(ind)])>0){
dat<-dat[,ind]
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,adj=0.8,font=2,cex=1,col=MPcols[i])
}else{
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
legend('center',legend="MP is prescriptive - no data used",bty='n')
}
}
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
if(sum(ind[2:length(ind)])>0){
dat<-dat[,ind]
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
}else{
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
legend('center',legend="No data used by MP",text.font=2,text.cex=1.3,bty='n')
}
mtext(MP,3,adj=0.8,font=2,cex=1,col=MPcols[i])
}
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
if(sum(ind[2:length(ind)])>0){
dat<-dat[,ind]
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
}else{
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
legend('center',legend="No data used by MP",text.font=2,cex=1.3,bty='n')
}
mtext(MP,3,adj=0.8,font=2,cex=1,col=MPcols[i])
}
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
if(sum(ind[2:length(ind)])>0){
dat<-dat[,ind]
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
}else{
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
legend('center',legend="No data used by MP",text.font=2,cex=1.3,bty='n')
}
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
mtext("Question / operating model characteristic",1,outer=T,line=0.5)
mtext("Variability in Long Term Yield (% LTY)",2,outer=T,line=0.5)
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
MPplot[i]<-sum(ind[2:length(ind)])>0
}
MPplot
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
nrow
maxcol
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
prescriptive<-MSEobj@MPs[!MPplot]
prescriptive
?legend
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements",text.font=2,cex=1.3,bty='n')
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements",cex=1.3,bty='n')
legend('center',legend=prescriptive,title="MPs without data requirements",title.font=2,cex=1.3,bty='n')
Required
Required()
MPs
MSEobj@Obs
ii<-4
t<-4
i<-4
MP<-MSEobj@MPs[i]
MP
VOIout[match(MP,VOIout[,1])+0:1,2:13]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
ind
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
dat
dat[2,]!=""
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
MPplot[i]<-sum(ind[1:length(ind)])>0
}
MPplot
MP<-1
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
dat
dat[2,]!=""|is.na(dat[2,])
ind<-dat[2,]!=""&!is.na(dat[2,])
ind
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements",cex=1.3,bty='n')
i<-4
MPplot
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
ind
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
dat
Obsgot<-as.character(unlist(dat[1,]))
Obsgot
dat
dim(dat)
!is.null(dim(dat))
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
if(!is.null(dim(dat))){
Obsgot<-as.character(unlist(dat[1,]))
}else{
Obsgot<-as.character(unlist(dat[1,1]))
}
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
if(!is.null(dim(dat))){
Obsgot<-as.character(unlist(dat[1,]))
}else{
Obsgot<-as.character(unlist(dat[1]))
}
Obsgot
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
if(!is.null(dim(dat))){
Obsgot<-as.character(unlist(dat[1,]))
}else{
Obsgot<-as.character(unlist(dat[1]))
}
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements",cex=1.3,bty='n')
i<-4
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-dat[,ind]
if(!is.null(dim(dat))){
Obsgot<-as.character(unlist(dat[1,]))
}else{
Obsgot<-as.character(unlist(dat[1]))
}
lab1<-Obstext[match(Obsgot,Obsnam)]
lab1
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat
dat<-dat[,ind,drop=F]
dat<-as.matrix(dat[,ind],ncol=sum(ind))
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
ind
dat<-as.matrix(dat[,ind],ncol=sum(ind))
dat
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
Obsgot
match(Obsgot,Obsnam)
lab1<-Obstext[match(Obsgot,Obsnam)]
lab1
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
labs
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
VOI_plot<-function(MSEobj,MSEobj_reb,options=list(),maxrow=1,maxcol=3){
MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements",cex=1.3,bty='n')
mtext("Question / operating model characteristic",1,outer=T,line=0.5)
mtext("Variability in Long Term Yield (% LTY)",2,outer=T,line=0.5)
}
MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
par(mfrow=c(max(maxrow,nrow),maxcol),mai=c(2.4,0.4,0.2,0.01),omi=c(0.3,0.3,0.05,0.01))
for(i in (1:MSEobj@nMPs)[MPplot]){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""
dat<-as.matrix(dat[,ind],ncol=sum(ind))
Obsgot<-as.character(unlist(dat[1,]))
lab1<-Obstext[match(Obsgot,Obsnam)]
dat2<-aggregate(as.numeric(as.character(unlist(dat[2,]))),by=list(lab1),max)
dat2<-dat2[order(dat2$x,decreasing=T),]
labs<-dat2[,1]
barplot(dat2[,2],names.arg=labs, las=2,col=rgb(0.4,0.8,0.95),border=NA,cex.axis=1.4,cex.names=1.3)
mtext(MP,3,font=2,cex=1,col=MPcols[i])
}
plot(c(0,1),axes=F,xlab="",ylab="",main='',col='white')
prescriptive<-MSEobj@MPs[!MPplot]
legend('center',legend=prescriptive,title="MPs without data requirements",cex=1.3,bty='n')
mtext("Question / operating model characteristic",1,outer=T,line=0.5)
mtext("Variability in Long Term Yield (% LTY)",2,outer=T,line=0.5)
MPcols<-rep('purple',MSEobj@nMPs)
Obsnam<-c("Abias",       "Aerr",        "betas",       "BMSY_B0bias", "Brefbias",    "CAA_ESS",     "CAL_ESS",    "Cbias",
"Crefbias",    "Csd",         "Dbias" ,      "Derr",        "FMSY_Mbias",  "hbias",       "Irefbias",    "Isd",         "Kbias",       "lenMbias",
"LFCbias",     "LFSbias",     "Linfbias",    "Mbias",       "Recsd",       "t0bias")
MSEobj@Obs<-MSEobj@Obs[,names(MSEobj@Obs)%in%Obsnam]
VOIout<-VOI(MSEobj,ncomp=12,nbins=8,plot=F)[[2]]
Obstext<- c("Abs. biomass bias","Abs. biomass Err.","Hyperstability","BMSY_B0 bias","BMSY bias","CAA n samps","CAL n samps","Catch bias",
"MSY bias","Catch Err.","Depletion bias","Depletion Err.","FMSY_M bias","Steepness bias", "Index Targ. bias", "Index Err.", "V.B. K bias", "Len. Mat. bias",
"Small Sel. bias", "Large Sel. bias", "V.B. Linf bias", "M bias", "Recruit. err", "VB t0 bias")
MPplot<-rep(F,MSEobj@nMPs)
for(i in 1:MSEobj@nMPs){
MP<-MSEobj@MPs[i]
dat<-VOIout[match(MP,VOIout[,1])+0:1,2:13]
ind<-dat[2,]!=""&!is.na(dat[2,])
MPplot[i]<-sum(ind[1:length(ind)])>0
}
nMPs<-sum(MPplot)+1 # plus the list of prescriptive MPs
nrow=ceiling(nMPs/maxcol)
nrow
runApp()
shiny::runApp()
